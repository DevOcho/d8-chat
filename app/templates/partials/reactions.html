{% for reaction in grouped_reactions %}
    {% set emoji = reaction.emoji %}
    {% set count = reaction.count %}
    {% set users = reaction.users %}
    {# Determine if the current logged-in user reacted with this emoji #}
    {% set user_has_reacted = g.user.id in users %}
    <button class="btn btn-sm reaction-pill {% if user_has_reacted %}user-reacted{% endif %}"
            data-reactor-ids="{{ users|join(',') }}"
            hx-post="{{ url_for('messages.toggle_reaction', message_id=message.id) }}"
            hx-vals='{"emoji": "{{ emoji }}"}'
            hx-swap="innerHTML"
            title="Reacted by: {{ reaction.reactor_names|join(", ") }}">
        <span>{{ emoji }}</span>
        <span class="reaction-count">{{ count }}</span>
    </button>
{% endfor %}
