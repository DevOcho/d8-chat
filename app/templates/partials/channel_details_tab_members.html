<!-- app/templates/partials/channel_details_tab_members.html -->
<div class="p-3">
    <!-- Invite New Members Form -->
    {% if current_user_membership.role == 'admin' or not channel.invites_restricted_to_admins %}
        <div class="mb-4">
            <h6 class="text-muted">Add Members</h6>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input class="form-control"
                       type="search"
                       name="q"
                       placeholder="Find by name or username"
                       autocomplete="off"
                       hx-get="{{ url_for('main.search_users_to_add', channel_id=channel.id) }}"
                       hx-trigger="keyup changed delay:300ms, search"
                       hx-target="#add-member-results"
                       hx-indicator="#add-member-spinner">
            </div>
             <!-- HTMX loading indicator -->
            <div class="text-center">
                <div id="add-member-spinner" class="spinner-border spinner-border-sm htmx-indicator" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
            <!-- 
              Container for the search results 
              [THE FIX] This now starts with a simple text prompt. The content
              will be replaced by HTMX as soon as the user starts typing.
            -->
            <div id="add-member-results" class="mt-2">
                <div class="list-group list-group-flush">
                    <div class="list-group-item text-muted fst-italic px-0">
                        Start typing to find users to add.
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <!-- Member Lists -->
    <h6 class="text-muted">Admins ({{ admins|length }})</h6>
    <ul class="list-group list-group-flush mb-4">
        {% for member in admins %}
            {% include 'partials/channel_member_item.html' %}
        {% endfor %}
    </ul>
    <h6 class="text-muted">Members ({{ members|length }})</h6>
    <ul class="list-group list-group-flush">
        {% for member in members %}
            {% include 'partials/channel_member_item.html' %}
        {% endfor %}
    </ul>
</div>
