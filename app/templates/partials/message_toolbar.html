<div class="message-toolbar">
    {# Emoji Reaction button #}
    <button class="btn btn-sm btn-light"
            data-bs-toggle="popover"
            data-message-id="{{ message.id }}"
            title="Add Reaction">
        <i class="bi bi-emoji-smile"></i>
    </button>
    {# Quote Reply Button #}
    {% if is_in_thread_view %}
        {# Inside a thread, target the thread's input container with a new route #}
        <button class="btn btn-sm btn-light"
                hx-get="/chat/message/{{ message.id }}/load_for_thread_reply"
                hx-target="#thread-input-container-{{ message.parent_message.id }}"
                hx-swap="outerHTML"
                title="Quote Reply">
            <i class="bi bi-reply-fill"></i>
        </button>
    {% else %}
        {# In the main channel, target the main input container #}
        <button class="btn btn-sm btn-light"
                hx-get="/chat/message/{{ message.id }}/reply"
                hx-target="#chat-input-container"
                hx-swap="outerHTML"
                data-action="reply"
                title="Quote Reply">
            <i class="bi bi-reply-fill"></i>
        </button>
        {# "Reply in Thread" button ONLY appears in main channel view #}
        {% if message.conversation.type == 'channel' %}
            <button class="btn btn-sm btn-light"
                    hx-get="{{ url_for('main.view_thread', parent_message_id=message.id) }}"
                    hx-target="#right-panel-offcanvas"
                    data-action="view-thread"
                    title="Reply in Thread">
                <i class="bi bi-chat-square-text-fill"></i>
            </button>
        {% endif %}
    {% endif %}
    {% if g.user.id == message.user.id %}
        {# Edit Button #}
        {% if is_in_thread_view %}
            {# When in a thread, target the thread's input container #}
            <button class="btn btn-sm btn-light"
                    hx-get="/chat/message/{{ message.id }}/load_for_thread_edit"
                    hx-target="#thread-input-container-{{ message.parent_message.id }}"
                    hx-swap="outerHTML"
                    data-action="edit"
                    title="Edit">
                <i class="bi bi-pencil-square"></i>
            </button>
        {% else %}
            {# When in the main view, target the main chat input container #}
            <button class="btn btn-sm btn-light"
                    hx-get="/chat/message/{{ message.id }}/load_for_edit"
                    hx-target="#chat-input-container"
                    hx-swap="outerHTML"
                    data-action="edit"
                    title="Edit">
                <i class="bi bi-pencil-square"></i>
            </button>
        {% endif %}
        {# Delete Button #}
        <button class="btn btn-sm btn-light"
                hx-delete="/chat/message/{{ message.id }}"
                hx-target="#message-{{ message.id }}"
                hx-swap="outerHTML"
                hx-confirm="Are you sure you want to delete this message?"
                data-action="delete"
                title="Delete">
            <i class="bi bi-trash"></i>
        </button>
    {% endif %}
</div>
