<!-- This partial renders a list of message results and a "Load More" button -->
{% for message in messages %}
    {# Use a DIV instead of an A tag to prevent default browser navigation #}
    <div class="text-decoration-none text-body search-result-item d-block py-2"
         style="cursor: pointer"
         hx-get="{{ url_for('main.jump_to_message', message_id=message.id) }}"
         hx-target="#chat-messages-container"
         hx-swap="innerHTML">
        <!-- Context Header -->
        <div class="search-result-context mb-1">
            <strong class="me-1">{{ message_context[message.id] }}</strong>
            <small class="text-muted">â€” {{ message.created_at.strftime("%b %d") }}</small>
        </div>
        <!-- Message Body -->
        <div class="d-flex">
            <div class="flex-shrink-0">
                <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center"
                     style="width: 40px;
                            height: 40px">{{ (message.user.display_name or message.user.username)[0]|upper }}</div>
            </div>
            <div class="flex-grow-1 ms-3">
                <div>
                    <strong class="me-2">{{ message.user.display_name or message.user.username }}</strong>
                    <small class="text-muted">{{ message.created_at.strftime("%I:%M %p") }}</small>
                </div>
                <div class="message-content text-muted">{{ message.content | highlight(query) }}</div>
            </div>
        </div>
    </div>
{% else %}
    {% if not request.args.get('page') or request.args.get('page') == '1' %}
        <p class="text-muted">No messages found matching your search.</p>
    {% endif %}
{% endfor %}
{% if has_more_messages %}
    <div class="mt-3 text-center"
         hx-get="{{ url_for('search.search_messages_paginated', q=query, page=current_page + 1) }}"
         hx-target="this"
         hx-swap="outerHTML">
        <button class="btn btn-outline-secondary">Load More</button>
    </div>
{% endif %}
