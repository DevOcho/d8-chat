{% extends "base.html" %}
{# set the style for the body #}
{% block body_class %}login-page{% endblock %}
{% block content %}
    <div class="login-page-container">
        <!-- Left Feature Panel -->
        <div class="feature-panel">
            <div class="feature-content">
                <img src="{{ url_for('static', filename='img/d8-chat-logo.png') }}"
                     alt="D8 Chat Logo"
                     class="login-logo mb-4">
                <h2 class="mb-4">A modern collaboration hub</h2>
                <p class="lead mb-5">All the features you need to keep your team in sync, delivered in real-time.</p>
                <ul class="feature-list">
                    <li>
                        <i class="bi bi-chat-dots-fill"></i> Real-time Messaging
                    </li>
                    <li>
                        <i class="bi bi-hash"></i> Public &amp; Private Channels
                    </li>
                    <li>
                        <i class="bi bi-send-fill"></i> Direct Messaging
                    </li>
                    <li>
                        <i class="bi bi-reply-fill"></i> Threaded Conversations
                    </li>
                    <li>
                        <i class="bi bi-emoji-smile-fill"></i> Emojis &amp; Reactions
                    </li>
                    <li>
                        <i class="bi bi-pencil-square"></i> Message Editing &amp; Deletion
                    </li>
                    <li>
                        <i class="bi bi-code-slash"></i> Markdown &amp; Code Snippets
                    </li>
                    <li>
                        <i class="bi bi-circle-fill"></i> User Presence Status
                    </li>
                </ul>
            </div>
        </div>
        <!-- Right Login Panel -->
        <div class="login-panel">
            <div class="login-form-container">
                <h1 class="mb-3">Login to D8 Chat</h1>
                <p class="text-muted mb-4">Enter your credentials or use SSO to continue.</p>
                {# --- [START OF CHANGES] --- #}
                <!-- Add this block to display login errors -->
                {% if request.args.get('error') %}
                    <div class="alert alert-danger" role="alert">{{ request.args.get("error") }}</div>
                {% endif %}
                <!-- Update the form tag and remove 'disabled' from inputs/button -->
                <form action="{{ url_for('auth.login') }}" method="POST">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username or Email</label>
                        <input type="text"
                               class="form-control"
                               id="username"
                               name="username"
                               placeholder="you@example.com"
                               required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <div class="password-field-wrapper">
                            <input type="password"
                                   class="form-control form-control-with-icon"
                                   id="password"
                                   name="password"
                                   required>
                            <span id="toggle-password-visibility"
                                  class="password-toggle-icon"
                                  title="Toggle password visibility">
                                <i class="bi bi-eye-slash"></i>
                            </span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-pink w-100">Login</button>
                </form>
                <div class="sso-divider">
                    <span>OR</span>
                </div>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('auth.sso_login') }}" class="btn btn-sso-authentik">
                        <i class="bi bi-key-fill"></i> Login with Authentik SSO
                    </a>
                    <a href="#" class="btn btn-sso-google">
                        <i class="bi bi-google"></i> Login with Google
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
  document.addEventListener('DOMContentLoaded', function() {
    const togglePasswordButton = document.getElementById('toggle-password-visibility');
    const passwordInput = document.getElementById('password');
    const icon = togglePasswordButton.querySelector('i');

    if (togglePasswordButton && passwordInput) {
      togglePasswordButton.addEventListener('click', function() {
        // Toggle the input type attribute
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);

        // Toggle the icon class
        if (type === 'password') {
          icon.classList.remove('bi-eye');
          icon.classList.add('bi-eye-slash');
        } else {
          icon.classList.remove('bi-eye-slash');
          icon.classList.add('bi-eye');
        }
      });
    }
  });
    </script>
{% endblock %}
