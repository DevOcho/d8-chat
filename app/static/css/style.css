body, html {
  height: 100%;
  overflow: hidden;
}
.main-layout {
  display: flex;
  flex-direction: row;
  height: 100vh;
}
.sidebar {
  flex-shrink: 0;
  overflow-y: auto;
}
.workspace-sidebar {
  width: 70px;
  background-color: #3f0e40;
  display: flex;
  flex-direction: column;
}
.channel-sidebar {
  width: 260px;
  background-color: #4a154b;
  color: #d1d2d3;
}
.main-content,
.container-fluid {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  height: 100vh;
  background-color: #ffffff;
}
.container-fluid {
    background-color: #f4f7fa;
    display: block;
}
.chat-messages {
  flex-grow: 1;
  overflow-y: auto;
  padding: 1rem;
}
.chat-input-form {
  flex-shrink: 0;
  padding: 1rem;
  background-color: #f8f9fa;
}
.message-container {
  position: relative;
  padding: 0.5rem;
  border-radius: 0.25rem;
}
.message-content {
    word-wrap: break-word;
}
.message-toolbar {
  position: absolute;
  top: 0;
  right: 0.5rem;
  display: none;
  background-color: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 0.25rem;
  padding: 0.25rem;
}
.message-container:hover .message-toolbar {
  display: block;
}
.quoted-reply {
  position: relative;
  background-color: #e9e9e9;
  border-left: 4px solid #03a9f4;
  border-radius: 4px;
  font-size: 0.9em;
  padding: 0.5em;
}
.codehilite {
    max-width: 100%;
    background: #27222;
    color: #f8f8f2;
    padding: 1em;
    border-radius: 4px;
}

/* --- [RESTORED] Login Page Styles --- */
html.login-page, body.login-page { overflow: auto; }
.login-page-container { display: flex; min-height: 100vh; width: 100%; background-color: #f8f9fa; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
.feature-panel { flex-basis: 45%; background-color: #1a1d21; color: #ffffff; padding: 3rem 4rem; display: flex; flex-direction: column; justify-content: center; }
.login-logo { max-width: 250px; height: auto; }
.feature-list { list-style: none; padding: 0; }
.feature-list li { font-size: 1.1rem; margin-bottom: 1rem; display: flex; align-items: center; }
.feature-list li i { color: #ec729c; font-size: 1.5rem; margin-right: 1rem; width: 30px; }
.login-panel { flex-basis: 55%; display: flex; justify-content: center; align-items: center; padding: 2rem; background-color: #ffffff; }
.login-form-container { max-width: 420px; width: 100%; }
.sso-divider { display: flex; align-items: center; text-align: center; color: #6c757d; margin: 2rem 0; }
.sso-divider::before, .sso-divider::after { content: ''; flex: 1; border-bottom: 1px solid #dee2e6; }
.sso-divider:not(:empty)::before { margin-right: .5em; }
.sso-divider:not(:empty)::after { margin-left: .5em; }
.btn-sso-authentik, .btn-sso-google { font-size: 1rem; padding: 0.75rem; border: 1px solid #dee2e6; background-color: #ffffff; color: #212529; text-align: center; }
.btn-sso-authentik:hover, .btn-sso-google:hover { background-color: #f8f9fa; border-color: #adb5bd; }
.btn-sso-authentik i, .btn-sso-google i { margin-right: 0.5rem; }
@media (max-width: 992px) { .login-page-container { flex-direction: column; } .feature-panel { flex-basis: auto; padding: 2rem; text-align: center; } .feature-list li { justify-content: center; } .login-logo { margin-left: auto; margin-right: auto; } .login-panel { flex-basis: auto; flex-grow: 1; } }

/* --- General App Styles --- */
.mentioned-message { background-color: #fffbeA; border-left: 3px solid #ffd700; }
.channel-sidebar a { color: #a9a9a9; transition: color 0.2s ease-in-out; }
.channel-sidebar a:hover, .channel-sidebar a.fw-bold.text-white { color: #ffffff !important; }

/* --- WYSIWYG Editor Styles --- */
.wysiwyg-editor-container { border: 1px solid #ced4da; border-radius: 0.25rem; background-color: #fff; transition: border-color 0.15s ease-in-out; }
.wysiwyg-toolbar { padding: 0.375rem 0.75rem; background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; display: flex; flex-wrap: wrap; gap: 0.5rem; }
.wysiwyg-toolbar-bottom { border-top: 1px solid #dee2e6; border-bottom: 0; }
.wysiwyg-toolbar button { background: none; border: 1px solid transparent; border-radius: 3px; padding: 4px 8px; cursor: pointer; font-size: 16px; line-height: 1; }
.wysiwyg-toolbar button:hover { background-color: #e2e6ea; }
.wysiwyg-toolbar button.active { background-color: #cfe2ff; color: #0d6efd; }
.wysiwyg-content { min-height: 38px; max-height: 30vh; overflow-y: auto; padding: 0.5rem 0.75rem; word-wrap: break-word; }
#chat-message-input, .toolbar-hidden { display: none; }
#markdown-toggle-view { height: 38px; min-height: 38px; resize: none; padding: 0.5rem 0.75rem; line-height: 1.5; max-height: 30vh; overflow-y: auto; }
.wysiwyg-editor-container > #markdown-toggle-view.form-control { border: 0; border-radius: 0; }
kbd { padding: 0.1em 0.4em; border-radius: 3px; border: 1px solid #b4b4b4; background-color: #f7f7f7; color: #333; font-size: 0.8em; font-family: monospace; }
#send-button.send-btn-dynamic { background-color: #fdf5f8; color: #495057; border: 1px solid #ec729c; padding: 0.375rem 0.75rem; display: flex; align-items: center; gap: 0.5rem; transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out; }
#send-button.send-btn-dynamic i { color: #ec729c; }
#send-button.send-btn-dynamic .send-shortcut { border-left: 1px solid rgba(236, 114, 156, 0.4); padding-left: 0.6rem; display: flex; align-items: center; gap: 0.2rem; }
#send-button.send-btn-dynamic:hover { background-color: #f8f9fa; border-color: #e35a8b; }
.wysiwyg-content:focus, #markdown-toggle-view:focus { outline: 0 !important; box-shadow: none !important; }

/* --- Rendered Message Content Styles --- */
.message-content > * + * { margin-top: 0.5em; }
.message-content ul, .message-content ol { padding-left: 2em; }
.message-content blockquote { border-left: 4px solid cornflowerblue; padding-left: 1rem; color: #555555; }
.wysiwyg-content blockquote { border-left: 4px solid cornflowerblue; padding-left: 1rem; color: #555555; margin: 0.5em 0; }
.message-content p, .message-content ul, .message-content ol, .message-content blockquote { margin: 0; }

/* --- Profile Button & Presence Styles --- */
.workspace-logo { font-size: 1.2rem; font-weight: bold; padding: 0.5rem; background-color: #49274b; border-radius: 8px; width: 44px; height: 44px; margin: 0 auto; display: flex; align-items: center; justify-content: center; }
.profile-button-container { padding-bottom: 0.5rem; }
.profile-avatar { position: relative; width: 36px; height: 36px; background-color: #49274b; border-radius: 50%; color: white; font-size: 1.1rem; font-weight: bold; display: flex; align-items: center; justify-content: center; margin: 0 auto; transition: box-shadow 0.2s ease-in-out; text-decoration: none; }
.profile-avatar:hover { box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2); }
.profile-header-avatar { position: relative; width: 60px; height: 60px; background-color: #007bff; border-radius: 50%; color: white; font-size: 1.5rem; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: box-shadow 0.2s ease-in-out; }
.profile-header-avatar .presence-indicator { position: absolute; bottom: 2px; right: 2px; width: 16px; height: 16px; border-radius: 50%; border: 3px solid #ffffff; }
.presence-online { background-color: #28a745; }
.presence-away { background-color: #6c757d; }
.presence-busy { background-color: #ffc107; }
.presence-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; vertical-align: middle; }
.profile-avatar .presence-indicator { position: absolute; bottom: -2px; right: -2px; width: 12px; height: 12px; border-radius: 50%; border: 2px solid #3f0e40; }

/* --- Dark Mode Overrides --- */
[data-bs-theme="dark"] {
    /* Main Layout */
    .workspace-sidebar { background-color: #1a1d21; }
    .channel-sidebar { background-color: #222529; }
    .main-content, .container-fluid { background-color: #2f3136 !important; }
    .chat-messages, .chat-input-form { background-color: #363f4f; }
    
    /* WYSIWYG Editor */
    .wysiwyg-editor-container { background-color: #40444b; border-color: #2f3136; }
    .wysiwyg-toolbar, .wysiwyg-toolbar-bottom { background-color: #40444b; border-color: #2f3136 !important; }
    .wysiwyg-content, #markdown-toggle-view { background-color: #40444b; color: #dcddde; }
    .wysiwyg-toolbar button:hover { background-color: #4e5258; }
    
    /* Send Button */
    #send-button.send-btn-dynamic { background-color: #40444b; color: #dcddde; }
    #send-button.send-btn-dynamic:hover { background-color: #4e5258; }
    
    /* Blockquotes */
    .message-content blockquote, .wysiwyg-content blockquote { border-left-color: cornflowerblue; color: #b9bbbe; }

    .quoted-reply {
        background-color: #2f3136; /* A darker background that fits the theme */
        color: #b9bbbe; /* A light, readable text color */
    }

    /* Dark mode style for editing block */
    .editing-block {
        background-color: #494a2b; /* Dark yellow/olive */
        border-left-color: #ffc107; /* Keep the amber color for visibility */
        color: #b9bbbe;
    }
    
    /* Profile Page Cards */
    .card { background-color: #36393f; border-color: #40444b; }
    .card-header { background-color: transparent; border-bottom-color: #40444b; }
    
    /* Presence dot borders */
    .profile-avatar .presence-indicator { border-color: #1a1d21; }
    .profile-header-avatar .presence-indicator { border-color: #2f3136; }
}

/* --- Emoji Picker Styles --- */
#emoji-picker-container {
    position: absolute;
    bottom: 100%; /* Position it right above the input container */
    right: 0;
    z-index: 1050; /* Ensure it appears above other elements */
    margin-bottom: 5px; /* Add a little space */
}

/* The picker itself comes with a shadow, but we can style it if needed */
emoji-picker {
    --indicator-color: #ec729c; /* Change the selection indicator color */
}
